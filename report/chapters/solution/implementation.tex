In the same way as for the last exercise a hierarchical structure was used,
where the processor had each stage as a component. This was done to provide
abstraction, and simplify the implementation. The VHDL component called
\emph{pipeline\_stage1} consists of traditional pipeline stages 0 and 1, since
each of these are relatively small. Stage two was mostly implemented the way it
was designed, but the hazard detection unit and control unit were placed in this
stage, since most signals connecting to these units go to stage 2. Stage 5 did
not get its own VHDL component, since the program counter was written into the
stage 1 component. The rest of the stage5 logic fit better inside the processor
component. The forwarding unit a component in the processor component due to
avoiding complexity in the VHDL components.
\subsection{Processor core}
The processor core itself was implemented as a messenger between the pipeline
stages, similarly to how toplevel works with respect to the core, com and mem
units. To make it obvious where a signal came from each was prefixed with
stage\_\#\_out\_, since many signals had the same name in different stages. In
addition, all component definitions and port maps were grouped and documented
according to where they were connected, making it easy to detect a desired
signal.
\textbf{TODO: decide on whether mem access will belong to components and be registered, or belong to processor and go unregistered, base on testing/timing results.}

\subsection{Control unit}
\textbf{TODO: changes to the control unit from last time}
\subsection{Hazards}
\textbf{TODO: choices regarding implementation of hazard control, including, but not limited to, forwarding, stalling, flushing and branching.}
\emph{Forwarding data from MEM to EX with the forwarding should fix most issues.
\\
We have implemented the simple branch prediction described in the book
(assume it will fall through), and the optimization moving the branch logic to
stage 2 (ID). We do not currently forward values to the branching check!
\\
Hazard detection unit should stall the pipeline necessary. More info on this
when it is confirmed or fixed.}

\subsection{????}